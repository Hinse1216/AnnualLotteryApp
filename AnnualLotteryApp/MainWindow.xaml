<Window x:Class="AnnualLotteryApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="年会抽奖" Height="540" Width="960" WindowStartupLocation="CenterScreen" Background="#020617"
        Loaded="Window_Loaded"
        Closed="MainWindow_Closed">
    <Grid>
        <Grid.Background>
            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                <GradientStop Color="#020617" Offset="0" />
                <GradientStop Color="#111827" Offset="0.6" />
                <GradientStop Color="#020617" Offset="1" />
            </LinearGradientBrush>
        </Grid.Background>

        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- 标题区 -->
            <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,16">
                <TextBlock Text="{Binding TitleText}" Foreground="White" FontSize="30" FontWeight="Bold" />
            </StackPanel>

            <!-- 中间展示区：左侧不滚动，右侧内部可滚动 -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2.1*" />
                    <ColumnDefinition Width="2.9*" />
                </Grid.ColumnDefinitions>

                <!-- 当前奖项与控制按钮（左侧可单独滚动） -->
                <Border Grid.Column="0" CornerRadius="16" Padding="18" Margin="0,0,18,0" Background="#020617CC">
                    <ScrollViewer VerticalScrollBarVisibility="Hidden"
                                  HorizontalScrollBarVisibility="Disabled"
                                  PanningMode="VerticalOnly">
                        <StackPanel>
                            <TextBlock Text="当前奖项" Foreground="#9CA3AF" FontSize="14" />
                            <ComboBox ItemsSource="{Binding PrizeLevels}"
                                      SelectedItem="{Binding SelectedPrizeLevel}"
                                      Margin="0,6,0,14" FontSize="16" />

                            <TextBlock Text="单次抽取人数" Foreground="#9CA3AF" FontSize="14" />
                            <TextBox Text="{Binding DrawCount, UpdateSourceTrigger=PropertyChanged}" Margin="0,6,0,16" FontSize="16" />

                            <!-- 中部改为：打开大屏按钮 -->
                            <StackPanel Orientation="Horizontal" Margin="0,4,0,0" HorizontalAlignment="Left">
                                <Button Width="110" Height="40" Margin="0,0,10,0"
                                        Content="打开抽奖"
                                        Command="{Binding ShowDrawWallCommand}" Background="#3B82F6" Foreground="White" FontWeight="Bold" />
                                <Button Width="110" Height="40"
                                        Content="中奖名单"
                                        Command="{Binding ShowWinnerWallCommand}" Background="#F97316" Foreground="White" FontWeight="Bold" />
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Margin="0,20,0,0">
                                <Button Content="导入名单" Command="{Binding ImportCommand}" Margin="0,0,10,0" Padding="10,4" />
                                <Button Content="导出结果" Command="{Binding ExportCommand}" Padding="10,4" />
                            </StackPanel>

                            <Separator Margin="0,18,0,12" Opacity="0.4" />

                            <TextBlock Text="总人数" Foreground="#9CA3AF" Margin="0,0,0,4" />
                            <TextBlock Text="{Binding TotalParticipants}" Foreground="White" FontSize="18" FontWeight="Bold" />

                            <TextBlock Text="剩余未中奖人数" Foreground="#9CA3AF" Margin="0,12,0,4" />
                            <TextBlock Text="{Binding RemainingParticipants}" Foreground="White" FontSize="18" FontWeight="Bold" />
                        </StackPanel>
                    </ScrollViewer>
                </Border>

                <!-- 滚动展示及中奖结果（右侧内部各自滚动） -->
                <Grid Grid.Column="1">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="2*" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <!-- 实时滚动显示 -->
                    <Border Grid.Row="0" CornerRadius="16" Background="#111827" Padding="20" Margin="0,0,0,10">
                        <ScrollViewer VerticalScrollBarVisibility="Hidden"
                                      HorizontalScrollBarVisibility="Disabled"
                                      PanningMode="VerticalOnly">
                            <StackPanel>
                                <TextBlock Text="实时滚动名单（当前轮）" Foreground="#9CA3AF" FontSize="14" Margin="0,0,0,8" />
                                <ItemsControl ItemsSource="{Binding RollingDisplayNames}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel HorizontalAlignment="Center" />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border CornerRadius="10" Background="#1F2937" Padding="8,6" Margin="5">
                                                <TextBlock Text="{Binding}" Foreground="White" FontSize="18" FontWeight="Bold" />
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </ScrollViewer>
                    </Border>

                    <!-- 当前轮中奖结果 -->
                    <Border Grid.Row="1" CornerRadius="16" Background="#111827" Padding="15">
                        <ScrollViewer VerticalScrollBarVisibility="Hidden"
                                      HorizontalScrollBarVisibility="Disabled"
                                      PanningMode="VerticalOnly">
                            <StackPanel>
                                <TextBlock Text="本轮中奖名单" Foreground="#FBBF24" FontSize="18" FontWeight="Bold" Margin="0,0,0,10" />
                                <ItemsControl ItemsSource="{Binding CurrentWinners}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border CornerRadius="4" Background="#1F2937" Padding="8" Margin="3">
                                                <TextBlock Text="{Binding}" Foreground="White" FontSize="16" />
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </ScrollViewer>
                    </Border>
                </Grid>
            </Grid>

            <!-- 底部按钮：开始/停止抽奖合并为单个切换按钮 + 恢复默认按钮 -->
            <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
                <Button Content="恢复默认" Width="110" Height="42" Margin="0,0,10,0"
                        Command="{Binding ResetConfigCommand}"
                        Background="#4B5563" Foreground="White" FontWeight="Bold" />

                <Button Width="150" Height="42" Margin="0,0,10,0"
                        Background="#10B981" Foreground="White" FontWeight="Bold">
                    <Button.Style>
                        <Style TargetType="Button">
                            <!-- 默认：开始抽奖 -->
                            <Setter Property="Command" Value="{Binding StartDrawCommand}" />
                            <Setter Property="Background" Value="#10B981" />
                            <Style.Triggers>
                                <!-- 抽奖进行中：切换为停止抽奖命令与样式，并根据 StopDrawCommand 决定是否可点 -->
                                <DataTrigger Binding="{Binding IsDrawing}" Value="True">
                                    <Setter Property="Command" Value="{Binding StopDrawCommand}" />
                                    <Setter Property="Background" Value="#EF4444" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border CornerRadius="21" Background="{TemplateBinding Background}" Padding="14,6">
                                <Border.Effect>
                                    <DropShadowEffect Color="#000000" BlurRadius="14" ShadowDepth="2" Opacity="0.6" />
                                </Border.Effect>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                                    <TextBlock FontSize="14" Margin="0,0,4,0">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Text" Value="▶" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsDrawing}" Value="True">
                                                        <Setter Property="Text" Value="■" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                    <TextBlock FontSize="14" FontWeight="Bold">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Text" Value="开始抽奖" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsDrawing}" Value="True">
                                                        <Setter Property="Text" Value="停止抽奖" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </StackPanel>
                            </Border>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
            </StackPanel>
        </Grid>
    </Grid>
</Window>