<Window x:Class="AnnualLotteryApp.Views.WinnerWallWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="中奖人员" WindowState="Maximized" WindowStyle="None" Background="#020617" AllowsTransparency="False"
        KeyDown="Window_KeyDown">
    <Window.Resources>
        <!-- 金粉飘落粒子样式 -->
        <Style x:Key="GoldParticleStyle" TargetType="Ellipse">
            <Setter Property="Width" Value="6" />
            <Setter Property="Height" Value="6" />
            <Setter Property="Fill" Value="#FACC15" />
            <Setter Property="Opacity" Value="0.8" />
        </Style>
    </Window.Resources>
    <Grid>
        <!-- 背景图片 + 渐变叠加，样式与抽奖大屏一致 -->
        <Grid.Background>
            <ImageBrush
                ImageSource="/data/imgBgd.png"
                Stretch="Fill"
                AlignmentX="Center"
                AlignmentY="Center" />
        </Grid.Background>
        <!-- 背景音乐 -->
        <MediaElement x:Name="BgMusic" Source="data/sndBgd.mp3" LoadedBehavior="Play" UnloadedBehavior="Stop" Volume="0.6" IsHitTestVisible="False" Visibility="Collapsed" />
        <Grid>
            <Grid.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="#B3020617" Offset="0" />
                    <GradientStop Color="#E0111827" Offset="0.6" />
                    <GradientStop Color="#B3020617" Offset="1" />
                </LinearGradientBrush>
            </Grid.Background>

            <!-- 金粉飘落层 -->
            <Canvas x:Name="GoldDustCanvas" IsHitTestVisible="False">
                <Canvas.Triggers>
                    <EventTrigger RoutedEvent="Loaded">
                        <BeginStoryboard>
                            <Storyboard RepeatBehavior="Forever">
                                <!-- 简单示例：从右上角往左下飘落的金粉 -->
                                <DoubleAnimation Storyboard.TargetName="Gold1" Storyboard.TargetProperty="(Canvas.Top)" From="-20" To="200" Duration="0:0:5" AutoReverse="False" RepeatBehavior="Forever" />
                                <DoubleAnimation Storyboard.TargetName="Gold1" Storyboard.TargetProperty="(Canvas.Left)" From="400" To="200" Duration="0:0:5" AutoReverse="False" RepeatBehavior="Forever" />

                                <DoubleAnimation Storyboard.TargetName="Gold2" Storyboard.TargetProperty="(Canvas.Top)" From="-40" To="260" Duration="0:0:7" AutoReverse="False" RepeatBehavior="Forever" />
                                <DoubleAnimation Storyboard.TargetName="Gold2" Storyboard.TargetProperty="(Canvas.Left)" From="460" To="260" Duration="0:0:7" AutoReverse="False" RepeatBehavior="Forever" />

                                <DoubleAnimation Storyboard.TargetName="Gold3" Storyboard.TargetProperty="(Canvas.Top)" From="-10" To="230" Duration="0:0:6" AutoReverse="False" RepeatBehavior="Forever" />
                                <DoubleAnimation Storyboard.TargetName="Gold3" Storyboard.TargetProperty="(Canvas.Left)" From="430" To="230" Duration="0:0:6" AutoReverse="False" RepeatBehavior="Forever" />

                                <DoubleAnimation Storyboard.TargetName="Gold1" Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:1" AutoReverse="True" RepeatBehavior="Forever" />
                                <DoubleAnimation Storyboard.TargetName="Gold2" Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:1.2" AutoReverse="True" RepeatBehavior="Forever" />
                                <DoubleAnimation Storyboard.TargetName="Gold3" Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:1.4" AutoReverse="True" RepeatBehavior="Forever" />
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                </Canvas.Triggers>

                <!-- 右上角一簇金粉 -->
                <Ellipse x:Name="Gold1" Style="{StaticResource GoldParticleStyle}" Canvas.Top="-20" Canvas.Left="400" />
                <Ellipse x:Name="Gold2" Style="{StaticResource GoldParticleStyle}" Canvas.Top="-40" Canvas.Left="460" />
                <Ellipse x:Name="Gold3" Style="{StaticResource GoldParticleStyle}" Canvas.Top="-10" Canvas.Left="430" />
            </Canvas>

            <Grid Margin="30">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- 顶部标题：改为垂直布局，整体水平居中，文字居中对齐 -->
                <StackPanel Grid.Row="0" Orientation="Vertical" HorizontalAlignment="Center" Margin="0,0,0,20">
                    <TextBlock Text="{Binding TitleText}"
                           Foreground="#E5E7EB"
                           FontSize="42"
                           FontWeight="SemiBold"
                           HorizontalAlignment="Center" />
                    <TextBlock Text="中奖人员"
                           Foreground="#FBBF24"
                           FontSize="48"
                           FontWeight="Bold"
                           Margin="0,10,0,0"
                           HorizontalAlignment="Center" />
                </StackPanel>

                <!-- 中间烟花背景层：始终显示 -->
                <Canvas Grid.Row="1"
                        x:Name="FireworkCanvas"
                        IsHitTestVisible="False"
                        Panel.ZIndex="0">
                    <Canvas.Triggers>
                        <EventTrigger RoutedEvent="Loaded">
                            <BeginStoryboard>
                                <Storyboard RepeatBehavior="Forever">
                                    <DoubleAnimation Storyboard.TargetName="Fw1" Storyboard.TargetProperty="Width" From="0" To="260" Duration="0:0:1.5" AutoReverse="False" RepeatBehavior="Forever" />
                                    <DoubleAnimation Storyboard.TargetName="Fw1" Storyboard.TargetProperty="Height" From="0" To="260" Duration="0:0:1.5" AutoReverse="False" RepeatBehavior="Forever" />
                                    <DoubleAnimation Storyboard.TargetName="Fw1" Storyboard.TargetProperty="Opacity" From="0.8" To="0" Duration="0:0:1.5" AutoReverse="False" RepeatBehavior="Forever" />

                                    <DoubleAnimation Storyboard.TargetName="Fw2" Storyboard.TargetProperty="Width" From="0" To="220" Duration="0:0:1.8" BeginTime="0:0:0.4" AutoReverse="False" RepeatBehavior="Forever" />
                                    <DoubleAnimation Storyboard.TargetName="Fw2" Storyboard.TargetProperty="Height" From="0" To="220" Duration="0:0:1.8" BeginTime="0:0:0.4" AutoReverse="False" RepeatBehavior="Forever" />
                                    <DoubleAnimation Storyboard.TargetName="Fw2" Storyboard.TargetProperty="Opacity" From="0.8" To="0" Duration="0:0:1.8" BeginTime="0:0:0.4" AutoReverse="False" RepeatBehavior="Forever" />

                                    <DoubleAnimation Storyboard.TargetName="Fw3" Storyboard.TargetProperty="Width" From="0" To="240" Duration="0:0:2.0" BeginTime="0:0:0.8" AutoReverse="False" RepeatBehavior="Forever" />
                                    <DoubleAnimation Storyboard.TargetName="Fw3" Storyboard.TargetProperty="Height" From="0" To="240" Duration="0:0:2.0" BeginTime="0:0:0.8" AutoReverse="False" RepeatBehavior="Forever" />
                                    <DoubleAnimation Storyboard.TargetName="Fw3" Storyboard.TargetProperty="Opacity" From="0.8" To="0" Duration="0:0:2.0" BeginTime="0:0:0.8" AutoReverse="False" RepeatBehavior="Forever" />
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger>
                    </Canvas.Triggers>

                    <!-- 三圈烟花，放在中间稍偏上区域 -->
                    <Ellipse x:Name="Fw1" Canvas.Left="350" Canvas.Top="140">
                        <Ellipse.Fill>
                            <RadialGradientBrush GradientOrigin="0.5,0.5" Center="0.5,0.5" RadiusX="0.5" RadiusY="0.5">
                                <GradientStop Color="#FFFDE68A" Offset="0" />
                                <GradientStop Color="#FFFACC15" Offset="0.3" />
                                <GradientStop Color="#00FACC15" Offset="1" />
                            </RadialGradientBrush>
                        </Ellipse.Fill>
                    </Ellipse>
                    <Ellipse x:Name="Fw2" Canvas.Left="580" Canvas.Top="130">
                        <Ellipse.Fill>
                            <RadialGradientBrush>
                                <GradientStop Color="#FFBFDBFE" Offset="0" />
                                <GradientStop Color="#FF3B82F6" Offset="0.4" />
                                <GradientStop Color="#003B82F6" Offset="1" />
                            </RadialGradientBrush>
                        </Ellipse.Fill>
                    </Ellipse>
                    <Ellipse x:Name="Fw3" Canvas.Left="150" Canvas.Top="130">
                        <Ellipse.Fill>
                            <RadialGradientBrush>
                                <GradientStop Color="#FFE9D5FF" Offset="0" />
                                <GradientStop Color="#FFA855F7" Offset="0.4" />
                                <GradientStop Color="#00A855F7" Offset="1" />
                            </RadialGradientBrush>
                        </Ellipse.Fill>
                    </Ellipse>
                </Canvas>

                <!-- 中间中奖墙：允许垂直滚动，避免底部遮挡，覆盖在烟花之上 -->
                <ScrollViewer Grid.Row="1"
                          VerticalScrollBarVisibility="Hidden"
                          HorizontalScrollBarVisibility="Disabled"
                          PanningMode="VerticalOnly"
                          Panel.ZIndex="1">
                    <ItemsControl ItemsSource="{Binding AllWinnersForWall}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel HorizontalAlignment="Center" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <!-- 将背景色由 #111827CC 调整为更深的 #020617E6 提升对比度 -->
                                <Border CornerRadius="12" Background="#020617E6" Padding="16" Margin="10" Width="260" Height="120">
                                    <StackPanel HorizontalAlignment="Center">
                                        <TextBlock Text="{Binding Prize}"
                                               Foreground="#FBBF24"
                                               FontSize="22"
                                               FontWeight="Bold"
                                               HorizontalAlignment="Center" />
                                        <TextBlock Text="{Binding Name}"
                                               Foreground="White"
                                               FontSize="30"
                                               FontWeight="Bold"
                                               Margin="0,8,0,0"
                                               TextWrapping="Wrap"
                                               TextTrimming="None"
                                               TextAlignment="Center"
                                               HorizontalAlignment="Center" />
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </Grid>
    </Grid>
</Window>